# SUPERCLEAN 脚本说明

## 脚本简介

`SUPERCLEAN` 是一个用于 AutoCAD 及兼容 CAD 平台的超级清理 LISP 脚本。它可一键批量清理图纸中的各种冗余对象和嵌套内容，包括：
- 外部参照（XREF）
- 光栅图像（IMAGE、块内递归）
- 图片字典
- OLE 对象（块内递归）
- 注册应用程序表（Regapps）
- 自动解锁/解冻/打开所有图层，确保所有对象可被操作
- 清理后自动恢复原有图层状态
- 极强兼容性，适配 AutoCAD、浩辰、天正等主流 CAD 平台

## 使用方法

1. 将脚本保存为 `superclean.lsp`
2. 在 CAD 命令行输入 `APPLOAD`，浏览加载此 LISP 文件
3. 命令行输入 `SUPERCLEAN`，按提示回车执行清理
4. 脚本会输出清理统计，如：
   ```
   清理完成：XREF=0，光栅实体=1，图片字典=0，OLE=0，Regapps=0
   ```

## 功能详解

- **全图层解锁/解冻/显示**：自动保存原有图层状态，并临时解锁、解冻、打开所有图层，确保所有对象都能被遍历和删除。
- **全递归块清理**：会递归查找每个块及其嵌套块中的光栅图像、OLE 对象，真正做到无遗漏。
- **图片字典清理**：清空 ACAD_IMAGE_DICT 中所有图片引用，防止残留图片数据。
- **注册表清理**：连同表对象中的注册应用表（Regapps）全部清理。
- **异常兼容与防错**：所有操作均用异常捕获，兼容不同CAD品牌和版本，遇到损坏对象自动跳过不中断。
- **恢复图层状态**：清理完成后自动恢复用户原有图层状态，不影响正常图纸使用。

## 常见问题

- **报错“图层无效”/`listp #<%catch-all-apply-error%>`**  
  已在本脚本中修复，所有对象类型和错误均有严格判断与兼容，极少数特殊CAD版本如仍报错，请反馈具体品牌和版本。

- **清理统计为 0 但实际还有对象？**  
  检查是否有对象被锁定、隐藏或在特殊块/参照中，建议先解锁/解冻所有图层再执行。

- **如需扩展清理（如未使用图层、未使用块、残留标注样式等）**  
  可在本脚本基础上继续开发，或向脚本作者/社区反馈新需求。

## 更新与维护

- 本脚本建议文件名：`superclean.lsp`
- 适配 AutoCAD 2010 及以上主流版本，兼容浩辰CAD、天正CAD等国产平台
- 由 Github Copilot AI 优化生成

---

如有特殊清理诉求或脚本报错，请附详细报错内容、CAD品牌和版本，便于进一步优化！
